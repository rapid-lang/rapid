
OCAMLC=ocamlc
OCAMLDEP=ocamldep
OCAMLLEX=ocamllex
OCAMLYACC=ocamlyacc

RAPID_OBJS = ast.cmo parser.cmo scanner.cmo compile.cmo generate.cmo rapid.cmo
PARSER_OBJS = ast.cmo parser.cmo scanner.cmo test_parser.cmo
SAST_OBJS = ast.cmo parser.cmo scanner.cmo sast_helper.cmo semantic_check.cmo test_sast.cmo
TARFILES = Makefile scanner.mll parser.mly ast.ml compile.ml rapid.ml

all: clean rapid parser sast

rapid: $(RAPID_OBJS)
	$(OCAMLC) -o rapid $(RAPID_OBJS)

parser: $(PARSER_OBJS)
	$(OCAMLC) -o parser $(PARSER_OBJS)

sast: $(SAST_OBJS)
	$(OCAMLC) -o sast $(SAST_OBJS)

test: parser sast parser_tests.sh
	./parser_tests.sh
	./sast_tests.sh

scanner.ml: scanner.mll
	$(OCAMLLEX) scanner.mll

parser.ml parser.mli: parser.mly
	$(OCAMLYACC) parser.mly

%.cmo: %.ml
	$(OCAMLC) -w A -c $<

%.cmi: %.mli
	$(OCAMLC) -w A -c $<

rapid.tar.gz: $(TARFILES)
	cd .. && tar czf rapid/rapid.tar.gz $(TARFILES:%=rapid/%)

.PHONY: clean parser test all
clean:
	rm -f rapid microc parser parser.ml parser.mli scanner.ml \
		*.cmo *.cmi *.out *.diff

# Generated by ocamldep *.ml *.mli
ast.cmo :
ast.cmx :
compile.cmo : ast.cmo
compile.cmx : ast.cmx
generate.cmo :
generate.cmx :
parser.cmo : ast.cmo parser.cmi
parser.cmx : ast.cmx parser.cmi
rapid.cmo : scanner.cmo parser.cmi generate.cmo compile.cmo ast.cmo
rapid.cmx : scanner.cmx parser.cmx generate.cmx compile.cmx ast.cmx
sast_helper.cmo : sast.cmi
sast_helper.cmx : sast.cmi
scanner.cmo : parser.cmi
scanner.cmx : parser.cmx
semantic_check.cmo : sast_helper.cmo sast.cmi ast.cmo
semantic_check.cmx : sast_helper.cmx sast.cmi ast.cmx
test_parser.cmo : scanner.cmo parser.cmi ast.cmo
test_parser.cmx : scanner.cmx parser.cmx ast.cmx
test_sast.cmo : semantic_check.cmo scanner.cmo parser.cmi
test_sast.cmx : semantic_check.cmx scanner.cmx parser.cmx
parser.cmi : ast.cmo
sast.cmi : ast.cmo
